load model-checker
load smtex

mod SMT-TEST is
  protecting BOOL .
  protecting BOOLEAN .
  protecting QUANTIFIER .
  protecting REAL-INTEGER .
  protecting STRING .

  including MODEL-CHECKER + SATISFACTION .
  protecting LTL .

  ops smtCheck : Boolean -> SmtResult [special (id-hook SpecialHubSymbol)].

---(
  data SmtResult where
    Sat :: SmtResult
    Unsat :: String -> SmtResult
)
  sort SmtResult .
  ops Sat : -> SmtResult [ctor] .
  ops Unsat_ : String -> SmtResult [ctor] .

  --- sorts SmtFormulaResult .
  --- subsorts Boolean < SmtFormulaResult .
  --- subsorts SmtResult < SmtFormulaResult .

---(
  data State where
    Start :: Boolean -> State
    End :: SmtResult -> State
)
  ops Start_ : Boolean -> State [ctor] .
  ops End_ : SmtResult -> State [ctor] .

  vars smtFormula : Boolean .
  vars unsatCore : SmtResult .

  --- We transition from S0 smtFormula to S1 smtFormula if smtFormula is deemed
  --- satisfiable by smt solver.
  crl [smt-sat] : Start smtFormula => End Sat
  if smtCheck(smtFormula) == Sat .

  crl [smt-unsat] : Start smtFormula => End unsatCore
  if unsatCore := smtCheck(smtFormula)
  /\ unsatCore =/= Sat .

  ops Success : -> Prop .
  eq End Sat |= Success = true .

  ops ltlFormula : -> Prop .
  eq ltlFormula = [] <> Success .

  ops X Y Z : -> Integer [ctor] .

  ops initialState : -> State .
  eq initialState
  = Start (forall X . forall Y . (X < Y implies exists Z . (X < Z and Z < Y))) .

endm